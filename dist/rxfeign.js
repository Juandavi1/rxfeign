"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const operators_1=require("rxjs/operators");require("reflect-metadata");const axios_1=require("axios"),rxjs_1=require("rxjs"),pathParamMetadataKey=Symbol("__pathParam__"),queryMetadataKey=Symbol("__queryParam__"),classMetadataKey=Symbol("__class__"),bodyMetadataKey=Symbol("__body__"),pathParamPropertyMetadataKey=Symbol("__pathParamProperty__"),mapperMetadataKey=Symbol("__mapper__"),headersMetadataKey=Symbol("__headers__"),beforeMetadataKey=Symbol("__headers__"),exceptionHandlerMetadataKey=Symbol("__handlerError__");function addInterceptors(...e){e.forEach(e=>exports.interceptors.unshift(new e))}function request(e,t="",a){return(r,s,o)=>{o.value=((...o)=>{const n=Reflect.getMetadata(classMetadataKey,r.constructor),d=Reflect.getMetadata(pathParamMetadataKey,r,s)||[],c=Reflect.getMetadata(queryMetadataKey,r,s)||[],p=Reflect.getMetadata(bodyMetadataKey,r,s)||[],l=Reflect.getMetadata(mapperMetadataKey,r,s)||null,i=Reflect.getMetadata(headersMetadataKey,r,s)||null,u=Reflect.getMetadata(beforeMetadataKey,r,s)||null,y=Reflect.getMetadata(exceptionHandlerMetadataKey,r,s)||null;"/"==t.charAt(0)&&(t=t.substr(1,t.length));const f=new HeadersHttp;let h=String();const m=o;let M=String(t);M=UtilsHttp.buildPathParams(d,m,M);const x=UtilsHttp.buildQueryParams(c,m);"object"==typeof n?(h=n.url,UtilsHttp.prepareHeaders(n.headers,f)):h=n,"/"!==h.charAt(h.length-1)&&(h=h.concat("/")),h=h.concat(M).concat("?"===x?"":x);const _="get"!==e?UtilsHttp.prepareBody(p,m):{};i&&Object.keys(i).forEach(e=>f.set(e,i[e]));let g={url:h,body:_,headers:f.getHeaders(),method:e};return g=u?u(g):g,exports.interceptors.forEach(e=>g=e.intercep(g)),rxjs_1.from(axios_1.default.request({method:g.method,data:g.body,headers:g.headers,url:g.url,responseType:"json"})).pipe(operators_1.map(({data:e})=>l?l(e):e),operators_1.catchError(e=>mapError(e,y,a)))})}}function mapError(e,t,a){const{config:r}=e,{data:s}=r,o=t?t(e):s&&s.message&&s.error?new HttpRequestException(s.error,e.response.status,s.message):new HttpRequestException(JSON.stringify(s),e.response.status,String());return rxjs_1.throwError(o)}function Body(e,t,a){const r=Reflect.getOwnMetadata(bodyMetadataKey,e,t)||[];r.unshift(a),Reflect.defineMetadata(bodyMetadataKey,r,e,t)}exports.interceptors=[],exports.addInterceptors=addInterceptors,exports.Client=(e=>t=>Reflect.defineMetadata(classMetadataKey,e,t)),exports.Get=((e,t=400)=>request("get",e,t)),exports.Post=((e,t=400)=>request("post",e,t)),exports.Put=((e,t=400)=>request("put",e,t)),exports.Patch=((e,t=400)=>request("patch",e,t)),exports.Delete=((e,t=400)=>request("delete",e,t)),exports.PathParam=(e=>(t,a,r)=>{const s=Reflect.getOwnMetadata(pathParamMetadataKey,t,a)||[];s.unshift({indexArgument:r,paramValue:e}),Reflect.defineMetadata(pathParamMetadataKey,s,t,a)}),exports.Query=(e=>(t,a,r)=>{const s=Reflect.getOwnMetadata(queryMetadataKey,t,a)||[];s.unshift({indexArgument:r,paramValue:e}),Reflect.defineMetadata(queryMetadataKey,s,t,a)}),exports.Body=Body,exports.PathParamProperty=(()=>(e,t)=>Reflect.defineMetadata(pathParamPropertyMetadataKey,{name:t},e,t)),exports.Mapper=(e=>(t,a)=>Reflect.defineMetadata(mapperMetadataKey,e,t,a)),exports.Headers=(e=>(t,a)=>Reflect.defineMetadata(headersMetadataKey,e,t,a)),exports.Before=(e=>(t,a)=>Reflect.defineMetadata(beforeMetadataKey,e,t,a)),exports.HandlerError=(e=>(t,a)=>Reflect.defineMetadata(exceptionHandlerMetadataKey,e,t,a));class UtilsHttp{static prepareHeaders(e={},t){Object.keys(e).forEach(a=>t.has(e[a])?null:t.set(a,e[a])),t.has("Content-Type")||t.set("Content-Type","application/json")}static buildQueryParams(e,t){let a="?";const r=String();return(e=e.filter(e=>t[e.indexArgument])).forEach((s,o)=>{if("object"==typeof t[s.indexArgument]){const e=Object.keys(t[s.indexArgument])||[];let o=0;for(const n in t[s.indexArgument])a=a.concat(`${n}=${t[s.indexArgument][n]}${o===e.length-1?r:"&"}`),o++}else{if(!s.paramValue)return;a=(a=a.length>1?a.concat("&"):a).concat(`${s.paramValue}=${t[s.indexArgument]}${o===e.length-1?r:"&"}`)}}),a}static buildPathParams(e,t,a){a=a.replace(/\s/g,"").trim();return e.filter(e=>e.paramValue).forEach(e=>{if(!e.paramValue)return;const r="{".concat(e.paramValue.toString()).concat("}");a.includes(r)&&(a=a.replace(r,t[e.indexArgument]))}),e.filter(e=>!e.paramValue).map(e=>a+=`/${t[e.indexArgument]}`),t.filter(e=>e&&"object"==typeof e).forEach(e=>Object.keys(e).forEach(t=>{const r=Reflect.getMetadata(pathParamPropertyMetadataKey,e,t);r&&(a=a.replace(`{${r.name}}`,e[r.name]))})),a}static prepareBody(e=[],t=[]){let a={};return e.filter(e=>"object"==typeof t[e]&&t[e]).forEach(e=>a=Object.assign({},a,t[e])),a}}class HttpRequestException{constructor(e,t,a){this.error=e,this.statusCode=t,this.message=a}}exports.HttpRequestException=HttpRequestException;class HeadersHttp{constructor(){this.headers=new Map}has(e){return this.headers.has(e)}set(e,t){return this.headers.set(e,t),this}getHeaders(){const e=Object();return Array.from(this.headers.keys()).forEach(t=>e[t]=this.headers.get(t)),e}}